mdupont@mdupont-G470:~/swarms-terraform/actions$ AWS_PROFILE=swarms bash ./call_swarms.sh

+ export REGION=us-east-2
+ REGION=us-east-2
+ TAG_KEY=Name
+ TAG_VALUE=docker-swarms-ami-t3.medium
+ GIT_URL=https://github.com/jmikedupont/swarms
+ export GIT_NAME=mdupont
+ GIT_NAME=mdupont
+ export GIT_VERSION=feature/squash2-docker
+ GIT_VERSION=feature/squash2-docker
+ DOCUMENT_NAME=deploy-docker
+ DOCUMENT_VERSION=1
+ TIMEOUT_SECONDS=600
+ MAX_CONCURRENCY=50
+ MAX_ERRORS=0
++ get_instance_ids
++ aws ec2 describe-instances --filters Name=tag:Name,Values=docker-swarms-ami-t3.medium --query 'Reservations[*].Instances[*].InstanceId' --output text --region us-east-2
+ for instance in $(get_instance_ids)
+ echo 'Instance ID: i-0a3dae164f8f3c09a'
Instance ID: i-0a3dae164f8f3c09a
++ send_command i-0a3dae164f8f3c09a
++ local instance_id=i-0a3dae164f8f3c09a
++ aws ssm send-command --document-name deploy-docker --document-version 1 --targets '[{"Key":"InstanceIds","Values":["i-0a3dae164f8f3c09a"]}]' --parameters '{"GitUrl":["https://github.com/jmikedupont/swarms"],"GitName":["mdupont"],"GitVersion":["feature/squash2-docker"]}' --timeout-seconds 600 --max-concurrency 50 --max-errors 0 --region us-east-2 --output-s3-bucket-name swarms-session-logs-20241221151754799300000003 --cloud-watch-output-config '{"CloudWatchOutputEnabled":true,"CloudWatchLogGroupName":"/ssm/session-logs-20241221151803393300000006"}'
+ result='{
    "Command": {
        "CommandId": "82d43144-a4f4-4b6d-a507-23ad5179e0b4",
        "DocumentName": "deploy-docker",
        "DocumentVersion": "1",
        "Comment": "",
        "ExpiresAfter": 1735009432.928,
        "Parameters": {
            "GitName": [
                "mdupont"
            ],
            "GitUrl": [
                "https://github.com/jmikedupont/swarms"
            ],
            "GitVersion": [
                "feature/squash2-docker"
            ]
        },
        "InstanceIds": [],
        "Targets": [
            {
                "Key": "InstanceIds",
                "Values": [
                    "i-0a3dae164f8f3c09a"
                ]
            }
        ],
        "RequestedDateTime": 1735005232.928,
        "Status": "Pending",
        "StatusDetails": "Pending",
        "OutputS3Region": "us-east-2",
        "OutputS3BucketName": "swarms-session-logs-20241221151754799300000003",
        "OutputS3KeyPrefix": "",
        "MaxConcurrency": "50",
        "MaxErrors": "0",
        "TargetCount": 0,
        "CompletedCount": 0,
        "ErrorCount": 0,
        "DeliveryTimedOutCount": 0,
        "ServiceRole": "",
        "NotificationConfig": {
            "NotificationArn": "",
            "NotificationEvents": [],
            "NotificationType": ""
        },
        "CloudWatchOutputConfig": {
            "CloudWatchLogGroupName": "/ssm/session-logs-20241221151803393300000006",
            "CloudWatchOutputEnabled": true
        },
        "TimeoutSeconds": 600,
        "AlarmConfiguration": {
            "IgnorePollAlarmFailure": false,
            "Alarms": []
        },
        "TriggeredAlarms": []
    }
}'
++ jq -r .Command.CommandId
++ echo '{' '"Command":' '{' '"CommandId":' '"82d43144-a4f4-4b6d-a507-23ad5179e0b4",' '"DocumentName":' '"deploy-docker",' '"DocumentVersion":' '"1",' '"Comment":' '"",' '"ExpiresAfter":' 1735009432.928, '"Parameters":' '{' '"GitName":' '[' '"mdupont"' '],' '"GitUrl":' '[' '"https://github.com/jmikedupont/swarms"' '],' '"GitVersion":' '[' '"feature/squash2-docker"' ']' '},' '"InstanceIds":' '[],' '"Targets":' '[' '{' '"Key":' '"InstanceIds",' '"Values":' '[' '"i-0a3dae164f8f3c09a"' ']' '}' '],' '"RequestedDateTime":' 1735005232.928, '"Status":' '"Pending",' '"StatusDetails":' '"Pending",' '"OutputS3Region":' '"us-east-2",' '"OutputS3BucketName":' '"swarms-session-logs-20241221151754799300000003",' '"OutputS3KeyPrefix":' '"",' '"MaxConcurrency":' '"50",' '"MaxErrors":' '"0",' '"TargetCount":' 0, '"CompletedCount":' 0, '"ErrorCount":' 0, '"DeliveryTimedOutCount":' 0, '"ServiceRole":' '"",' '"NotificationConfig":' '{' '"NotificationArn":' '"",' '"NotificationEvents":' '[],' '"NotificationType":' '""' '},' '"CloudWatchOutputConfig":' '{' '"CloudWatchLogGroupName":' '"/ssm/session-logs-20241221151803393300000006",' '"CloudWatchOutputEnabled":' true '},' '"TimeoutSeconds":' 600, '"AlarmConfiguration":' '{' '"IgnorePollAlarmFailure":' false, '"Alarms":' '[]' '},' '"TriggeredAlarms":' '[]' '}' '}'
+ command_id=82d43144-a4f4-4b6d-a507-23ad5179e0b4
+ aws ssm wait command-executed --command-id 82d43144-a4f4-4b6d-a507-23ad5179e0b4 --region us-east-2 --instance i-0a3dae164f8f3c09a
+ fetch_command_output 82d43144-a4f4-4b6d-a507-23ad5179e0b4
+ local command_id=82d43144-a4f4-4b6d-a507-23ad5179e0b4
+ jq -r '.CommandInvocations[] | {InstanceId, Status, Output}'

Lets get the log outputs and the cloudtrails and the cloudwatch logs for this command
+ aws ssm list-command-invocations --command-id 82d43144-a4f4-4b6d-a507-23ad5179e0b4 --details --region us-east-2
{
  "InstanceId": "i-0a3dae164f8f3c09a",
  "Status": "Success",
  "Output": null
}


To obtain the log outputs, cloudtrail logs, and cloudwatch logs for the specified AWS Systems
Manager (SSM) command, follow these steps:

*** Step 1: Retrieve the Output from the Command Execution

Since the output is ~null~ in your provided response, we'll first try to fetch the output directly.
#+BEGIN_SRC sh
aws ssm list-command-invocations --command-id 82d43144-a4f4-4b6d-a507-23ad5179e0b4 --details --region us-east-2 --profile swarms
#+END_SRC

Lets fetch the results
#+RESULTS:
| {                          |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "CommandInvocations":      | [                                                                                                                                                                                   |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| {                          |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "CommandId":               | "82d43144-a4f4-4b6d-a507-23ad5179e0b4",                                                                                                                                             |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "InstanceId":              | "i-0a3dae164f8f3c09a",                                                                                                                                                              |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "InstanceName":            | "ip-10-0-4-93.us-east-2.compute.internal",                                                                                                                                          |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "Comment":                 | "",                                                                                                                                                                                 |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "DocumentName":            | "deploy-docker",                                                                                                                                                                    |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "DocumentVersion":         | "1",                                                                                                                                                                                |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "RequestedDateTime":       | 1735005232.999,                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "Status":                  | "Success",                                                                                                                                                                          |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "StatusDetails":           | "Success",                                                                                                                                                                          |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "StandardOutputUrl":       | "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/82d43144-a4f4-4b6d-a507-23ad5179e0b4/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stdout", |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "StandardErrorUrl":        | "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/82d43144-a4f4-4b6d-a507-23ad5179e0b4/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stderr", |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "CommandPlugins":          | [                                                                                                                                                                                   |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| {                          |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "Name":                    | "DeployDocker",                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "Status":                  | "Success",                                                                                                                                                                          |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "StatusDetails":           | "Success",                                                                                                                                                                          |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "ResponseCode":            | 0,                                                                                                                                                                                  |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "ResponseStartDateTime":   | 1735005233.167,                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "ResponseFinishDateTime":  | 1735005237.002,                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "Output":                  | "oops\nYour                                                                                                                                                                         | branch | is | up | to | date | with | 'origin/feature/squash2-docker'.\n-- | No | entries | --\n\n----------ERROR-------\nerror: | remote | mdupont | already | exists.\nAlready | on | 'feature/squash2-docker'\nbash: | /opt/swarms/api/docker-boot.sh: | No | such | file | or | directory\nFailed | to | restart | swarms-docker.service: | Unit | swarms-docker.service | not | found.\n", |
| "StandardOutputUrl":       | "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/82d43144-a4f4-4b6d-a507-23ad5179e0b4/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stdout", |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "StandardErrorUrl":        | "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/82d43144-a4f4-4b6d-a507-23ad5179e0b4/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stderr", |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "OutputS3Region":          | "us-east-2",                                                                                                                                                                        |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "OutputS3BucketName":      | "swarms-session-logs-20241221151754799300000003",                                                                                                                                   |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "OutputS3KeyPrefix":       | 82d43144-a4f4-4b6d-a507-23ad5179e0b4/i-0a3dae164f8f3c09a/awsrunShellScript                                                                                                          |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| }                          |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| ],                         |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "ServiceRole":             | "",                                                                                                                                                                                 |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "NotificationConfig":      | {                                                                                                                                                                                   |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "NotificationArn":         | "",                                                                                                                                                                                 |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "NotificationEvents":      | [],                                                                                                                                                                                 |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "NotificationType":        |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| },                         |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "CloudWatchOutputConfig":  | {                                                                                                                                                                                   |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "CloudWatchLogGroupName":  | "/ssm/session-logs-20241221151803393300000006",                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| "CloudWatchOutputEnabled": | true                                                                                                                                                                                |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| }                          |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| }                          |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| ]                          |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |
| }                          |                                                                                                                                                                                     |        |    |    |    |      |      |                                      |    |         |                                      |        |         |         |                  |    |                                 |                                 |    |      |      |    |                   |    |         |                        |      |                       |     |            |

If the ~--details~ flag doesn't provide the output, you may need to retrieve it using another
method. One common approach is to use CloudWatch Logs.

*** Step 2: Retrieve Output from CloudWatch Logs

Assuming the SSM command execution generated logs in CloudWatch Logs, you can find the specific log
group and stream associated with your command ID.

1. *Get the Log Group Name*:
   The log group name typically follows a pattern like ~/aws/ssm/<region>/<account-id>~. You need to
   determine which exact account ID is used for this output.

2. *Search for Logs in CloudWatch Logs*:
   Use the AWS Management Console or ~aws logs~ command line tool to search for logs in the
   appropriate log group.

**** Using AWS CLI:
#+BEGIN_SRC sh
aws logs get-log-events --log-group-name /aws/ssm/us-east-2/123456789012 --start-time 1672531200000
--end-time 1675123200000
#+END_SRC

Replace ~123456789012~ with your actual account ID and set the time range to match when the command
was executed.

**** Using AWS Management Console:

1. Open the CloudWatch Logs console.
2. Navigate to the log group ~/aws/ssm/us-east-2/123456789012~.
3. Use the search bar to filter logs for the command ID ~82d43144-a4f4-4b6d-a507-23ad5179e0b4~.

*** Step 3: Retrieve CloudTrail Logs

CloudTrail records all API calls made by AWS users. You can find the logs that correspond to your
SSM command execution.

1. *Open the CloudTrail Console*:
   Navigate to the CloudTrail console and select your trail or go directly to the event management
   page.

2. *Search for Events*:
   Use the search bar to filter events based on ~EventName~ being ~StartCommand~, ~CancelCommand~,
   etc., and use the command ID ~82d43144-a4f4-4b6d-a507-23ad5179e0b4~.




+ aws ssm list-command-invocations --command-id 6c96c523-2970-4071-9d5d-f95a041703ef --details --region us-east-2
{
  "CommandInvocations": [
    {
      "CommandId": "6c96c523-2970-4071-9d5d-f95a041703ef",
      "InstanceId": "i-0a3dae164f8f3c09a",
      "InstanceName": "ip-10-0-4-93.us-east-2.compute.internal",
      "Comment": "",
      "DocumentName": "deploy-docker",
      "DocumentVersion": "$LATEST",
      "RequestedDateTime": 1735058288.722,
      "Status": "Success",
      "StatusDetails": "Success",
      "StandardOutputUrl": "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/6c96c523-2970-4071-9d5d-f95a041703ef/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stdout",
      "StandardErrorUrl": "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/6c96c523-2970-4071-9d5d-f95a041703ef/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stderr",
      "CommandPlugins": [
        {
          "Name": "DeployDocker",
          "Status": "Success",
          "StatusDetails": "Success",
          "ResponseCode": 0,
          "ResponseStartDateTime": 1735058288.981,
          "ResponseFinishDateTime": 1735058293.354,
          "Output": "cd /opt/swarms/\nexport HOME=/home/swarms/\ngit config --global user.email \"git-agent@swarms.ai\"\ngit config --global user.name \"git agent\"\ngit remote add mdupont https://github.com/jmikedupont2/swarms  || echo oops\ngit remote set-url mdupont https://github.com/jmikedupont2/swarms  || echo oops2\necho git url https://github.com/jmikedupont2/swarms\ngit fetch --all|| echo oops        \ngit pull mdupont  feature/squash2-docker|| echo oops        \ngit checkout --force feature/squash2-docker || echo checkout\ngit log -3 || echo git fail\nls /opt/swarms/api/*.sh || echo no files\noops\ngit url https://github.com/jmikedupont2/swarms\nFetching origin\nFetching mdupont\nUpdating 62a7b307..68755906\nFast-forward\n api/docker-boot.sh                | 16 +++++++++\n api/rundocker.sh                  | 76 +++++++++++++++++++++++++++++++++++++++\n api/systemd/swarms-docker.service | 25 +++++++++++++\n 3 files changed, 117 insertions(+)\n create mode 100644 api/docker-boot.sh\n create mode 100644 api/rundocker.sh\n create mode 100644 api/systemd/swarms-docker.service\nYour branch is up to date with 'origin/feature/squash2-docker'.\ncommit 68755906be19d73deb0c8c5144323ecd3c203068\nAuthor: mike dupont <mike.dupont@introspector.local>\nD\n---Output truncated---\n----------ERROR-------\n+ chown -R swarms:swarms /opt/swarms\n+ tee /opt/swarms/update_docker_swarms.sh\n+ sudo chown swarms /opt/swarms/update_docker_swarms.sh\n+ su -c 'bash -e -x /opt/swarms/update_docker_swarms.sh' swarms\n+ cd /opt/swarms/\n+ export HOME=/home/swarms/\n+ HOME=/home/swarms/\n+ git config --global user.email git-agent@swarms.ai\n+ git config --global user.name 'git agent'\n+ git remote add mdupont https://github.com/jmikedupont2/swarms\nerror: remote mdupont already exists.\n+ echo oops\n+ git remote set-url mdupont https://github.com/jmikedupont2/swarms\n+ echo git url https://github.com/jmikedupont2/swarms\n+ git fetch --all\nFrom https://github.com/jmikedupont2/swarms\n   62a7b307..68755906  feature/squash2-docker -> origin/feature/squash2-docker\n+ git pull mdupont feature/squash2-docker\nFrom https://github.com/jmikedupont2/swarms\n * branch              feature/squash2-docker -> FETCH_HEAD\n+ git checkout --force feature/squash2-docker\nAlready on 'feature/squash2-docker'\n+ git log -3\n+ ls /opt/swarms/api/boot.sh /opt/swarms/api/boot_fast.sh /opt/swarms/api/docker-boot.sh /opt/swarms/api/install.sh /opt/swarms/api/just_run.sh /opt/swarms/api/rerun-git.sh /opt/swarms/api/rerun.sh /opt/swarms/api/run_logs.sh /opt/swa\n---Error truncated----",
          "StandardOutputUrl": "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/6c96c523-2970-4071-9d5d-f95a041703ef/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stdout",
          "StandardErrorUrl": "
          "OutputS3Region": "us-east-2",
          "OutputS3BucketName": "swarms-session-logs-20241221151754799300000003",
          "OutputS3KeyPrefix": "6c96c523-2970-4071-9d5d-f95a041703ef/i-0a3dae164f8f3c09a/awsrunShellScript"
        }
      ],
      "ServiceRole": "",
      "NotificationConfig": {
        "NotificationArn": "",
        "NotificationEvents": [],
        "NotificationType": ""
      },
      "CloudWatchOutputConfig": {
        "CloudWatchLogGroupName": "/ssm/session-logs-20241221151803393300000006",
        "CloudWatchOutputEnabled": true
      }
    }
  ]
}

aws logs get-log-events --log-group-name /ssm/session-logs-20241221151803393300000006 
#aws logs describe-log-streams        --log-group-name "CloudWatchLogGroupName": "/ssm/session-logs-20241221151803393300000006 --profile swarms --region us-east-2
#aws logs describe-log-streams        --log-group-name /ssm/session-logs-20241221151803393300000006 --profile swarms --region us-east-2
aws logs describe-log-streams        --log-group-name /ssm/session-logs-20241221151803393300000006 --profile swarms --region us-east-2 --output json | jq . > logstreams.json
aws logs get-log-events --log-group-name /ssm/session-logs-20241221151803393300000006  --log-stream-name $(jq ".logStreams[0].logStreamName" logstreams.json) --region us-east-2 --profile swarms

#jq ".logStreams[0].logStreamName" logstreams.json
  awslogs groups

  /aws/application-signals/data
/aws/appsignals/ec2
/aws/appsignals/eks
/aws/appsignals/generic
/aws/appsignals/k8s

  /ec2/init
/ec2/secure
/ec2/system
/ssm/session-logs-20241221151803393300000006
/swarms/nginx_error
/swarms/ngnix_access
/swarms/systemd

  awslogs get /swarms/systemd

  awslogs get /ssm/session-logs-20241221151803393300000006





  mdupont@mdupont-G470:~/swarms-terraform/actions$ bash ./call_swarms.sh 
+ export REGION=us-east-2
+ REGION=us-east-2
+ TAG_KEY=Name
+ TAG_VALUE=docker-swarms-ami-t3.medium
+ GIT_URL=https://github.com/jmikedupont2/swarms
+ export GIT_NAME=mdupont
+ GIT_NAME=mdupont
+ export GIT_VERSION=feature/squash2-docker
+ GIT_VERSION=feature/squash2-docker
+ DOCUMENT_NAME=deploy-docker
+ DOCUMENT_VERSION='$LATEST'
+ TIMEOUT_SECONDS=600
+ MAX_CONCURRENCY=50
+ MAX_ERRORS=0
++ get_instance_ids
++ aws ec2 describe-instances --filters Name=tag:Name,Values=docker-swarms-ami-t3.medium --query 'Reservations[*].Instances[*].InstanceId' --output text --region us-east-2
+ for instance in $(get_instance_ids)
+ echo 'Instance ID: i-0a3dae164f8f3c09a'
Instance ID: i-0a3dae164f8f3c09a
++ send_command i-0a3dae164f8f3c09a
++ local instance_id=i-0a3dae164f8f3c09a
++ aws ssm send-command --document-name deploy-docker --document-version '$LATEST' --targets '[{"Key":"InstanceIds","Values":["i-0a3dae164f8f3c09a"]}]' --parameters '{"GitUrl":["https://github.com/jmikedupont2/swarms"],"GitName":["mdupont"],"GitVersion":["feature/squash2-docker"]}' --timeout-seconds 600 --max-concurrency 50 --max-errors 0 --region us-east-2 --output-s3-bucket-name swarms-session-logs-20241221151754799300000003 --cloud-watch-output-config '{"CloudWatchOutputEnabled":true,"CloudWatchLogGroupName":"/ssm/session-logs-20241221151803393300000006"}'
+ result='{
    "Command": {
        "CommandId": "11548a23-624f-4fac-a085-d813e91f5fff",
        "DocumentName": "deploy-docker",
        "DocumentVersion": "$LATEST",
        "Comment": "",
        "ExpiresAfter": 1735139787.028,
        "Parameters": {
            "GitName": [
                "mdupont"
            ],
            "GitUrl": [
                "https://github.com/jmikedupont2/swarms"
            ],
            "GitVersion": [
                "feature/squash2-docker"
            ]
        },
        "InstanceIds": [],
        "Targets": [
            {
                "Key": "InstanceIds",
                "Values": [
                    "i-0a3dae164f8f3c09a"
                ]
            }
        ],
        "RequestedDateTime": 1735135587.028,
        "Status": "Pending",
        "StatusDetails": "Pending",
        "OutputS3Region": "us-east-2",
        "OutputS3BucketName": "swarms-session-logs-20241221151754799300000003",
        "OutputS3KeyPrefix": "",
        "MaxConcurrency": "50",
        "MaxErrors": "0",
        "TargetCount": 0,
        "CompletedCount": 0,
        "ErrorCount": 0,
        "DeliveryTimedOutCount": 0,
        "ServiceRole": "",
        "NotificationConfig": {
            "NotificationArn": "",
            "NotificationEvents": [],
            "NotificationType": ""
        },
        "CloudWatchOutputConfig": {
            "CloudWatchLogGroupName": "/ssm/session-logs-20241221151803393300000006",
            "CloudWatchOutputEnabled": true
        },
        "TimeoutSeconds": 600,
        "AlarmConfiguration": {
            "IgnorePollAlarmFailure": false,
            "Alarms": []
        },
        "TriggeredAlarms": []
    }
}'
++ jq -r .Command.CommandId
lets fetch the full log
++ echo '{' '"Command":' '{' '"CommandId":' '"11548a23-624f-4fac-a085-d813e91f5fff",' '"DocumentName":' '"deploy-docker",' '"DocumentVersion":' '"$LATEST",' '"Comment":' '"",' '"ExpiresAfter":' 1735139787.028, '"Parameters":' '{' '"GitName":' '[' '"mdupont"' '],' '"GitUrl":' '[' '"https://github.com/jmikedupont2/swarms"' '],' '"GitVersion":' '[' '"feature/squash2-docker"' ']' '},' '"InstanceIds":' '[],' '"Targets":' '[' '{' '"Key":' '"InstanceIds",' '"Values":' '[' '"i-0a3dae164f8f3c09a"' ']' '}' '],' '"RequestedDateTime":' 1735135587.028, '"Status":' '"Pending",' '"StatusDetails":' '"Pending",' '"OutputS3Region":' '"us-east-2",' '"OutputS3BucketName":' '"swarms-session-logs-20241221151754799300000003",' '"OutputS3KeyPrefix":' '"",' '"MaxConcurrency":' '"50",' '"MaxErrors":' '"0",' '"TargetCount":' 0, '"CompletedCount":' 0, '"ErrorCount":' 0, '"DeliveryTimedOutCount":' 0, '"ServiceRole":' '"",' '"NotificationConfig":' '{' '"NotificationArn":' '"",' '"NotificationEvents":' '[],' '"NotificationType":' '""' '},' '"CloudWatchOutputConfig":' '{' '"CloudWatchLogGroupName":' '"/ssm/session-logs-20241221151803393300000006",' '"CloudWatchOutputEnabled":' true '},' '"TimeoutSeconds":' 600, '"AlarmConfiguration":' '{' '"IgnorePollAlarmFailure":' false, '"Alarms":' '[]' '},' '"TriggeredAlarms":' '[]' '}' '}'
+ command_id=11548a23-624f-4fac-a085-d813e91f5fff
+ aws ssm wait command-executed --command-id 11548a23-624f-4fac-a085-d813e91f5fff --region us-east-2 --instance i-0a3dae164f8f3c09a
+ fetch_command_output 11548a23-624f-4fac-a085-d813e91f5fff
+ local command_id=11548a23-624f-4fac-a085-d813e91f5fff
+ jq .
+ aws ssm list-command-invocations --command-id 11548a23-624f-4fac-a085-d813e91f5fff --details --region us-east-2
{
  "CommandInvocations": [
    {
      "CommandId": "11548a23-624f-4fac-a085-d813e91f5fff",
      "InstanceId": "i-0a3dae164f8f3c09a",
      "InstanceName": "ip-10-0-4-93.us-east-2.compute.internal",
      "Comment": "",
      "DocumentName": "deploy-docker",
      "DocumentVersion": "$LATEST",
      "RequestedDateTime": 1735135587.107,
      "Status": "Success",
      "StatusDetails": "Success",
      "StandardOutputUrl": "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/11548a23-624f-4fac-a085-d813e91f5fff/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stdout",
      "StandardErrorUrl": "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/11548a23-624f-4fac-a085-d813e91f5fff/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stderr",
      "CommandPlugins": [
        {
          "Name": "DeployDocker",
          "Status": "Success",
          "StatusDetails": "Success",
          "ResponseCode": 0,
          "ResponseStartDateTime": 1735135587.335,
          "ResponseFinishDateTime": 1735135668.743,
          "Output": "cd /opt/swarms/\nexport HOME=/home/swarms/\ngit config --global user.email \"git-agent@swarms.ai\"\ngit config --global user.name \"git agent\"\ngit remote add mdupont https://github.com/jmikedupont2/swarms  || echo oops\ngit remote set-url mdupont https://github.com/jmikedupont2/swarms  || echo oops2\necho git url https://github.com/jmikedupont2/swarms\ngit fetch --all|| echo oops        \ngit pull mdupont  feature/squash2-docker|| echo oops        \ngit checkout --force feature/squash2-docker || echo checkout\ngit log -3 || echo git fail\nls /opt/swarms/api/*.sh || echo no files\noops\ngit url https://github.com/jmikedupont2/swarms\nFetching origin\nFetching mdupont\nUpdating 68755906..3e0a7ead\nFast-forward\n api/docker-boot.sh | 19 +++++++++++++++----\n api/rundocker.sh   | 12 ++++++++++--\n 2 files changed, 25 insertions(+), 6 deletions(-)\nYour branch is up to date with 'origin/feature/squash2-docker'.\ncommit 3e0a7ead57e7f53cfd5ac0034b5ec40ac7cbfafc\nAuthor: mike dupont <mike.dupont@introspector.local>\nDate:   Tue Dec 24 12:19:11 2024 -0500\n\n    shell check\n\ncommit 24af710cb49da489ae8e1aa86a641e02a5e01f2c\nAuthor: mike dupont <mike.dupont@introspector.local>\nDate:   Tue Dec 24 12:17:53 2024 -0500\n\n    going to test\n\n\n---Output truncated---\n----------ERROR-------\n+ chown -R swarms:swarms /opt/swarms\n+ tee /opt/swarms/update_docker_swarms.sh\n+ sudo chown swarms /opt/swarms/update_docker_swarms.sh\n+ su -c 'bash -e -x /opt/swarms/update_docker_swarms.sh' swarms\n+ cd /opt/swarms/\n+ export HOME=/home/swarms/\n+ HOME=/home/swarms/\n+ git config --global user.email git-agent@swarms.ai\n+ git config --global user.name 'git agent'\n+ git remote add mdupont https://github.com/jmikedupont2/swarms\nerror: remote mdupont already exists.\n+ echo oops\n+ git remote set-url mdupont https://github.com/jmikedupont2/swarms\n+ echo git url https://github.com/jmikedupont2/swarms\n+ git fetch --all\nFrom https://github.com/jmikedupont2/swarms\n   68755906..3e0a7ead  feature/squash2-docker -> origin/feature/squash2-docker\nFrom https://github.com/jmikedupont2/swarms\n   68755906..3e0a7ead  feature/squash2-docker -> mdupont/feature/squash2-docker\n+ git pull mdupont feature/squash2-docker\nFrom https://github.com/jmikedupont2/swarms\n * branch              feature/squash2-docker -> FETCH_HEAD\n+ git checkout --force feature/squash2-docker\nAlready on 'feature/squash2-docker'\n+ git log -3\n+ ls /opt/swarms/api/boot.sh /opt/swarms/api/boot_fast.sh /opt/swarms/api/docker-boot.sh /opt/swarms/api/insta\n---Error truncated----",
          "StandardOutputUrl": "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/11548a23-624f-4fac-a085-d813e91f5fff/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stdout",
          "StandardErrorUrl": "https://s3.us-east-2.amazonaws.com/swarms-session-logs-20241221151754799300000003/11548a23-624f-4fac-a085-d813e91f5fff/i-0a3dae164f8f3c09a/awsrunShellScript/DeployDocker/stderr",
          "OutputS3Region": "us-east-2",
          "OutputS3BucketName": "swarms-session-logs-20241221151754799300000003",
          "OutputS3KeyPrefix": "11548a23-624f-4fac-a085-d813e91f5fff/i-0a3dae164f8f3c09a/awsrunShellScript"
        }
      ],
      "ServiceRole": "",
      "NotificationConfig": {
        "NotificationArn": "",
        "NotificationEvents": [],
        "NotificationType": ""
      },
      "CloudWatchOutputConfig": {
        "CloudWatchLogGroupName": "/ssm/session-logs-20241221151803393300000006",
        "CloudWatchOutputEnabled": true
      }
    }
  ]
}
